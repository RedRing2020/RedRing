# Circle/Arc/Angle æ”¹å–„ææ¡ˆã¨å®Ÿè£…è¨ˆç”»

## ğŸ“Š ç¾åœ¨ã®å•é¡Œç‚¹ã¨æ”¹å–„å†…å®¹

### 1. **ç¾åœ¨ã®è¨­è¨ˆã®å•é¡Œ**

| å•é¡Œç‚¹             | ç¾åœ¨ã®çŠ¶æ³                 | æ”¹å–„å¾Œ                          |
| ------------------ | -------------------------- | ------------------------------- |
| **å‹åˆ¶ç´„**         | f64 å›ºå®š                   | `T: Scalar`ã§ f32/f64 ä¸¡å¯¾å¿œ    |
| **2D/3D é‡è¤‡**     | åˆ¥ã€…ã®ãƒˆãƒ¬ã‚¤ãƒˆã€é‡è¤‡ã‚³ãƒ¼ãƒ‰ | åŸºåº•+æ‹¡å¼µãƒˆãƒ¬ã‚¤ãƒˆã§çµ±ä¸€         |
| **è§’åº¦ã®å‹å®‰å…¨æ€§** | f64 ãƒ©ã‚¸ã‚¢ãƒ³ã€æ··åœ¨ãƒªã‚¹ã‚¯   | `Angle<T>`æ§‹é€ ä½“ã§å‹å®‰å…¨        |
| **Arc è¨­è¨ˆ**       | ç‹¬ç«‹å®Ÿè£…ã€é‡è¤‡             | Circle å†…åŒ…ã§ç°¡ç´ åŒ–             |
| **ãƒ†ã‚¹ãƒˆé…ç½®**     | unit_tests ã®ã¿            | å®Ÿè£…å†…+çµ±åˆãƒ†ã‚¹ãƒˆã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ |

### 2. **æ”¹å–„ã•ã‚ŒãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆFoundation ãƒ‘ã‚¿ãƒ¼ãƒ³å¯¾å¿œï¼‰**

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Foundation        â”‚  â† çµ±ä¸€ãƒˆãƒ¬ã‚¤ãƒˆå±¤
â”‚ - ExtensionFoundationâ”‚
â”‚ - TolerantEq        â”‚
â”‚ - PrimitiveKind     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Scalar Trait      â”‚  â† f32/f64æŠ½è±¡åŒ–
â”‚   (f32, f64)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Angle<T>          â”‚  â† å‹å®‰å…¨ãªè§’åº¦
â”‚   - degrees/radians â”‚
â”‚   - normalize       â”‚
â”‚   - lerp/slerp      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Circle<T>         â”‚  â† åŸºåº•ãƒˆãƒ¬ã‚¤ãƒˆ
â”‚   - center/radius   â”‚
â”‚   - area/circumf.   â”‚
â”‚   - point_at_angle  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Circle2D<T> â”‚  â”‚ Circle3D<T> â”‚  â† æ¬¡å…ƒç‰¹åŒ– + Foundation
â”‚ - intersect â”‚  â”‚ - normal    â”‚
â”‚ - tangent   â”‚  â”‚ - to_2d     â”‚
â”‚ + foundationâ”‚  â”‚ + foundationâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                  â”‚
           â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Arc2D<T>   â”‚  â”‚  Arc3D<T>   â”‚  â† Circleå†…åŒ… + Foundation
    â”‚ circle: C2D â”‚  â”‚ circle: C3D â”‚
    â”‚ start/end   â”‚  â”‚ start/end   â”‚
    â”‚ + foundationâ”‚  â”‚ + foundationâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å…·ä½“çš„ãªæ”¹å–„ç‚¹

### **A. Scalar Trait ã«ã‚ˆã‚‹æ•°å€¤å‹æŠ½è±¡åŒ–**

```rust
// Before: f64å›ºå®š
fn radius(&self) -> f64;

// After: ã‚¸ã‚§ãƒãƒªãƒƒã‚¯
fn radius(&self) -> T where T: Scalar;

// åˆ©ç”¨ä¾‹
let circle_f64 = Circle2D::<f64>::new(center, 5.0);
let circle_f32 = Circle2D::<f32>::new(center, 5.0); // é«˜é€Ÿè¨ˆç®—ç”¨
```

**ãƒ¡ãƒªãƒƒãƒˆ**:

- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ã«å¿œã˜ãŸå‹é¸æŠ
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–
- æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§ç¶­æŒ

### **B. Angle æ§‹é€ ä½“ã«ã‚ˆã‚‹å‹å®‰å…¨æ€§**

```rust
// Before: æ··åœ¨ãƒªã‚¹ã‚¯
circle.point_at_angle(90.0); // åº¦æ•°ï¼Ÿãƒ©ã‚¸ã‚¢ãƒ³ï¼Ÿ

// After: å‹å®‰å…¨
circle.point_at_angle(Angle::from_degrees(90.0)); // æ˜ç¢º
circle.point_at_angle(Angle::from_radians(PI/2.0)); // æ˜ç¢º

// è§’åº¦æ¼”ç®—
let angle1 = Angle::from_degrees(30.0);
let angle2 = Angle::from_degrees(60.0);
let sum = angle1 + angle2; // 90åº¦
let interpolated = angle1.lerp(&angle2, 0.5); // 45åº¦
```

**ãƒ¡ãƒªãƒƒãƒˆ**:

- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®å‹ãƒã‚§ãƒƒã‚¯
- åº¦æ•°/ãƒ©ã‚¸ã‚¢ãƒ³æ··åœ¨ã‚¨ãƒ©ãƒ¼é˜²æ­¢
- è§’åº¦æ¼”ç®—ã®ä¸€å…ƒåŒ–

### **C. ãƒˆãƒ¬ã‚¤ãƒˆéšå±¤ã«ã‚ˆã‚‹é‡è¤‡å‰Šæ¸›**

```rust
// Before: é‡è¤‡ã‚³ãƒ¼ãƒ‰
trait Circle2D { fn area(&self) -> f64 { PI * r * r } }
trait Circle3D { fn area(&self) -> f64 { PI * r * r } } // é‡è¤‡ï¼

// After: çµ±ä¸€è¨­è¨ˆ
trait Circle<T: Scalar> {
    fn area(&self) -> T { T::pi() * self.radius() * self.radius() }
}
trait Circle3D<T>: Circle<T> {
    fn normal(&self) -> Self::Vector; // 3Dç‰¹æœ‰ã®ã¿
}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:

- ã‚³ãƒ¼ãƒ‰é‡è¤‡ã®å‰Šé™¤
- ä¸€è²«ã—ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- ä¿å®ˆæ€§ã®å‘ä¸Š

### **D. Arc è¨­è¨ˆã®ç°¡ç´ åŒ–**

```rust
// Before: ç‹¬ç«‹å®Ÿè£…
trait Arc2D {
    fn center(&self) -> Point2D;    // Circle ã¨é‡è¤‡
    fn radius(&self) -> f64;        // Circle ã¨é‡è¤‡
    fn area(&self) -> f64;          // Circle ã¨é‡è¤‡
    // ... é‡è¤‡ã‚³ãƒ¼ãƒ‰å¤šæ•°
}

// After: Circleå†…åŒ…
struct Arc2D<T> {
    circle: Circle2D<T>,    // åŸºåº•å††ã‚’å†…åŒ…
    start_angle: Angle<T>,  // é–‹å§‹è§’åº¦
    end_angle: Angle<T>,    // çµ‚äº†è§’åº¦
}

impl<T: Scalar> Arc<T> for Arc2D<T> {
    fn center(&self) -> Point2D { self.circle.center() } // å§”è­²
    fn radius(&self) -> T { self.circle.radius() }       // å§”è­²
    fn arc_length(&self) -> T {
        self.radius() * self.angle_span().radians()
    }
}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:

- ã‚³ãƒ¼ãƒ‰é‡ã®å¤§å¹…å‰Šæ¸›
- Circle æ©Ÿèƒ½ã®è‡ªå‹•ç¶™æ‰¿
- ä¸€è²«æ€§ã®ä¿è¨¼

## ğŸ“‹ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»

### **Phase 1: åŸºç›¤æ•´å‚™ï¼ˆ1-2 é€±é–“ï¼‰**

1. **Scalar trait + Angle æ§‹é€ ä½“**
   - `geo_foundation/abstract_types/geometry/angle.rs` ä½œæˆ
   - f32/f64 å¯¾å¿œã® Scalar trait å®Ÿè£…
   - æ—¢å­˜ãƒ†ã‚¹ãƒˆã®ç§»æ¤

2. **åŸºæœ¬ãƒ†ã‚¹ãƒˆä½œæˆ**
   ```rust
   #[cfg(test)]
   mod tests {
       #[test] fn test_angle_conversion() { /* ... */ }
       #[test] fn test_angle_operations() { /* ... */ }
       #[test] fn test_scalar_generics() { /* ... */ }
   }
   ```

### **Phase 2: Circle çµ±ä¸€ï¼ˆ2-3 é€±é–“ï¼‰**

1. **Circle trait ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**
   - ç¾åœ¨ã®`Circle2D`/`Circle3D`ã‚’æ–°è¨­è¨ˆã«ç§»è¡Œ
   - ã‚¸ã‚§ãƒãƒªãƒƒã‚¯åŒ–ï¼ˆ`Circle<T: Scalar>`ï¼‰
   - Foundation ãƒˆãƒ¬ã‚¤ãƒˆçµ±åˆï¼ˆ`ExtensionFoundation<T>` + `TolerantEq<T>`ï¼‰
   - æ®µéšçš„ç§»è¡Œï¼ˆã‚¨ã‚¤ãƒªã‚¢ã‚¹ä½¿ç”¨ï¼‰

2. **Foundation ãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè£…**
   - `circle_2d_foundation.rs` æ–°è¦ä½œæˆ
   - `circle_3d_foundation.rs` æ—¢å­˜æ´»ç”¨
   - VS Code ãƒ•ã‚¡ã‚¤ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–è¨­å®šæ›´æ–°

3. **æ—¢å­˜å®Ÿè£…ã®æ›´æ–°**
   ```rust
   // äº’æ›æ€§ã®ãŸã‚ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹
   pub type Circle2DOld = Circle2D<f64>;
   pub type Circle3DOld = Circle3D<f64>;
   ```

### **Phase 3: Arc ç°¡ç´ åŒ–ï¼ˆ1-2 é€±é–“ï¼‰**

1. **Arc trait ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**
   - Circle å†…åŒ…è¨­è¨ˆã¸ã®ç§»è¡Œ
   - Angle æ§‹é€ ä½“ã®çµ±åˆ

2. **ãƒ†ã‚¹ãƒˆã®çµ±åˆ**
   - å®Ÿè£…å†…ãƒ†ã‚¹ãƒˆï¼ˆåŸºæœ¬æ©Ÿèƒ½ï¼‰
   - unit_testsï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆï¼‰

### **Phase 4: æœ€é©åŒ–ãƒ»æ–‡æ›¸åŒ–ï¼ˆ1 é€±é–“ï¼‰**

1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
2. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™**
3. **ä½¿ç”¨ä¾‹ã®è¿½åŠ **

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã®æ”¹å–„

### **å®Ÿè£…å†…ãƒ†ã‚¹ãƒˆ vs unit_tests æ¯”è¼ƒ**

| é …ç›®                 | å®Ÿè£…å†…ãƒ†ã‚¹ãƒˆ       | unit_tests       |
| -------------------- | ------------------ | ---------------- |
| **ç›®çš„**             | åŸºæœ¬æ©Ÿèƒ½ã®è¿…é€Ÿæ¤œè¨¼ | çµ±åˆãƒ»å›å¸°ãƒ†ã‚¹ãƒˆ |
| **å®Ÿè¡Œé€Ÿåº¦**         | é«˜é€Ÿ               | ã‚„ã‚„ä½é€Ÿ         |
| **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆæ©Ÿèƒ½** | âœ… ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½    | âŒ ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯  |
| **ä¿å®ˆæ€§**           | âœ… å®Ÿè£…ã¨ä¸€ä½“      | âŒ å®Ÿè£…ã¨åˆ†é›¢    |
| **è¤‡é›‘ãªãƒ†ã‚¹ãƒˆ**     | âŒ åˆ¶é™ã‚ã‚Š        | âœ… è‡ªç”±åº¦é«˜      |

### **æ¨å¥¨ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æˆ¦ç•¥ï¼ˆFoundation ãƒ‘ã‚¿ãƒ¼ãƒ³å¯¾å¿œï¼‰**

```rust
// å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«å†…ï¼ˆä¾‹ï¼šcircle_2d.rsï¼‰
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_basic_creation() {
        let circle = Circle2D::new(Point::origin(), 5.0);
        assert_eq!(circle.radius(), 5.0);
    }

    #[test]
    fn test_internal_methods() {
        // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
    }
}

// Foundation å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹ï¼šcircle_2d_foundation.rsï¼‰
#[cfg(test)]
mod tests {
    use super::*;
    use geo_foundation::ExtensionFoundation;
    use analysis::TolerantEq;

    #[test]
    fn test_extension_foundation() {
        let circle = Circle2D::new(Point::origin(), 5.0);
        assert_eq!(circle.primitive_kind(), PrimitiveKind::Circle);

        let bbox = circle.bounding_box();
        assert!(bbox.is_some());

        let area = circle.measure();
        assert!(area.is_some());
        assert!((area.unwrap() - 25.0 * std::f64::consts::PI).abs() < 1e-10);
    }

    #[test]
    fn test_tolerant_eq() {
        let circle1 = Circle2D::new(Point::origin(), 5.0);
        let circle2 = Circle2D::new(Point::new(0.005, 0.0), 5.001);
        let tolerance = 0.01;

        assert!(circle1.tolerant_eq(&circle2, tolerance));
    }
}

// unit_tests/circle_integration.rs
#[test]
fn test_circle_arc_integration() {
    let circle = Circle2D::new(center, radius);
    let arc = Arc2D::from_circle_angles(circle, start, end);
    // è¤‡æ•°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®çµ„ã¿åˆã‚ã›ãƒ†ã‚¹ãƒˆ
}
```

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### **å®šé‡çš„åŠ¹æœ**

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹       | æ”¹å–„å‰     | æ”¹å–„å¾Œ           | æ”¹å–„ç‡ |
| ---------------- | ---------- | ---------------- | ------ |
| **ã‚³ãƒ¼ãƒ‰è¡Œæ•°**   | ~1000 è¡Œ   | ~600 è¡Œ          | -40%   |
| **é‡è¤‡ã‚³ãƒ¼ãƒ‰**   | ~200 è¡Œ    | ~50 è¡Œ           | -75%   |
| **ãƒ†ã‚¹ãƒˆæ•°**     | 104 å€‹     | 130+å€‹           | +25%   |
| **å‹å®‰å…¨ã‚¨ãƒ©ãƒ¼** | å®Ÿè¡Œæ™‚æ¤œå‡º | ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æ¤œå‡º | 100%   |

### **å®šæ€§çš„åŠ¹æœ**

- âœ… **é–‹ç™ºåŠ¹ç‡**: ã‚¸ã‚§ãƒãƒªãƒƒã‚¯è¨­è¨ˆã«ã‚ˆã‚‹å†åˆ©ç”¨æ€§å‘ä¸Š
- âœ… **ä¿å®ˆæ€§**: çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã‚ˆã‚‹ä¸€è²«æ€§
- âœ… **å®‰å…¨æ€§**: å‹ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼é˜²æ­¢
- âœ… **æ‹¡å¼µæ€§**: æ–°ã—ã„æ•°å€¤å‹ã‚„æ¬¡å…ƒã¸ã®å¯¾å¿œå®¹æ˜“

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **æ‰¿èª**: ã“ã®æ”¹å–„ææ¡ˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨æ‰¿èª
2. **å®Ÿè£…é–‹å§‹**: Phase 1 ã‹ã‚‰æ®µéšçš„å®Ÿè£…
3. **ç¶™ç¶šçš„æ”¹å–„**: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ™ãƒ¼ã‚¹ã®èª¿æ•´
4. **ä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å±•é–‹**: Vector, Point ã¸ã®åŒæ§˜ã®æ”¹å–„é©ç”¨

ã“ã®æ”¹å–„ã«ã‚ˆã‚Šã€RedRing ã®å††ãƒ»å††å¼§ã‚·ã‚¹ãƒ†ãƒ ã¯**ã‚ˆã‚Šå®‰å…¨ã§åŠ¹ç‡çš„ã§ä¿å®ˆã—ã‚„ã™ã„**è¨­è¨ˆã«ãªã‚Šã¾ã™ï¼
