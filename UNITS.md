# RedRing 単位系統一仕様

## 基本単位系

RedRing プロジェクト全体で使用する単位系を以下に統一します：

### 長さ

- **基本単位: mm (ミリメートル)**
- すべての座標値、距離、寸法は mm 単位で表現
- 許容誤差も同様に mm 単位で設定

### 角度

- **基本単位: ラジアン (rad)**
- 内部計算は全てラジアン単位
- UI での表示は度 (degree) に変換可能

### その他の単位

- 面積: mm² (平方ミリメートル)
- 体積: mm³ (立方ミリメートル)
- 曲率: mm⁻¹ (逆ミリメートル)

## 許容誤差設定

### 標準設定 (standard)

```rust
ToleranceContext {
    linear: 1e-6,      // 1マイクロメートル (0.001mm)
    angular: 1e-8,     // 約0.0057度
    parametric: 1e-10, // パラメータ空間の無次元許容誤差
    curvature: 1e-3,   // 曲率許容誤差 (mm⁻¹)
    area: 1e-12,       // 面積許容誤差 (mm²)
    volume: 1e-18,     // 体積許容誤差 (mm³)
}
```

### 高精度設定 (high_precision)

```rust
ToleranceContext {
    linear: 1e-9,      // 1ナノメートル (0.000001mm)
    angular: 1e-10,    // より高精度な角度
    parametric: 1e-12, // より高精度なパラメータ
    curvature: 1e-6,   // 高精度曲率 (mm⁻¹)
    area: 1e-18,       // 高精度面積 (mm²)
    volume: 1e-27,     // 高精度体積 (mm³)
}
```

### 緩い設定 (relaxed)

```rust
ToleranceContext {
    linear: 1e-3,      // 1マイクロメートル (0.001mm)
    angular: 1e-6,     // 低精度角度
    parametric: 1e-8,  // 低精度パラメータ
    curvature: 1e-1,   // 低精度曲率 (mm⁻¹)
    area: 1e-6,        // 低精度面積 (mm²)
    volume: 1e-9,      // 低精度体積 (mm³)
}
```

## 実装指針

### 1. 入力データの変換

- 外部ファイル (STL, STEP, OBJ 等) からの入力データは、必要に応じて mm 単位に変換
- 変換係数:
  - メートル → mm: `* 1000.0`
  - インチ → mm: `* 25.4`
  - フィート → mm: `* 304.8`

### 2. 表示・出力での変換

- UI 表示では用途に応じて適切な単位に変換
  - 大きな寸法: m (メートル)
  - 通常の寸法: mm (ミリメートル)
  - 微細な寸法: μm (マイクロメートル)

### 3. API ドキュメント

- すべての関数、構造体で長さに関わるパラメータには単位をコメントで明記
- 例: `pub fn move_by(&mut self, delta: Vector3D) // delta in mm`

### 4. テストケース

- テストケースでは実際の CAD 作業で使用される現実的な値を使用
- 例:
  - ボルト穴径: 8.0 (8mm)
  - 板厚: 5.0 (5mm)
  - 機械部品サイズ: 100.0 〜 1000.0 (100mm〜1000mm)

## 移行作業

### geo-core クレート

- [x] ToleranceContext の単位系コメント整備済み
- [ ] Scalar の単位系ドキュメント追加
- [ ] Vector2D/Vector3D の単位系コメント追加

### analysis クレート

- [ ] 数値解析関数のパラメータ単位コメント追加
- [ ] サンプリング関数の距離パラメータ単位明記
- [ ] 統計解析結果の単位情報追加

### model クレート

- [ ] 既存幾何要素の単位系コメント整備
- [ ] アダプターレイヤーの単位変換確認

### render/stage クレート

- [ ] 描画座標系と CAD 座標系の変換確認
- [ ] ビューポート変換での単位一貫性確保

## 注意事項

1. **浮動小数点精度**: mm 単位での計算により、f64 の精度内で十分な精度を確保
2. **オーバーフロー防止**: 極端に大きな値 (>1e12 mm = 1,000 km) への対策
3. **アンダーフロー防止**: 極端に小さな値 (<1e-12 mm = 1 pm) への対策
4. **国際化対応**: 将来的にインチ系表示への対応可能性を考慮

---

**重要**: この仕様に従い、すべての新規実装およびリファクタリングを実施すること。
単位系の混在はバグの原因となるため、厳格に統一を維持する。
